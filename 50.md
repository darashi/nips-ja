NIP-50
======

検索機能
-----------------

`draft` `optional`

## 概要

多くのNostrのユースケースでは、タグやIDによる構造化されたクエリに加えて、何らかの形の一般的な検索機能が必要となる。
検索アルゴリズムの詳細はイベントのkindによって異なるはずなので、
このNIPでは、そのようなクエリを実現するための一般的で拡張可能なフレームワークのみを記述する。

## `search` フィルタフィールド

クライアントが送信する`REQ`メッセージに、新たに`search`フィールドが導入される:
```json
{
  ...
  "search": <string>
}
```
`search`フィールドは、クエリを人間可読な形式で表現したものだ(例: "best nostr apps")。
リレーは、できる限り最善の方法によってクエリを解釈し、それにマッチするイベントを返すべきだ(SHOULD)。
リレーは、`content`イベントフィールドに対してマッチングを実行すべきであり(SHOULD)、
その他のフィールドに対するマッチングも、特定のkindについて意味がある場合には実行してもよい(MAY)。

クエリ文字列は、`key:value`ペア(コロンで区切られた2つの単語)を含むかもしれない。このようなものは拡張であり、リレーは
サポートしていない拡張は無視すべきだ(SHOULD)。

クライアントは、複数の検索フィルタを指定できる。例えば、`["REQ", "", { "search": "orange" }, { "kinds": [1, 2], "search": "purple" }]`のようにだ。クライアントは、
`kinds`、`ids`などの他のフィルタフィールドを含めることで、検索結果を特定のイベントに限定できる。

クライアントは、リレーが`search`フィルタをサポートしているかどうかを知るために、supported_nipsフィールドを使うべきだ(SHOULD)。
クライアントは、このNIPをサポートしていないリレーからの余分な応答をフィルタリングするつもりであれば、`search`フィルタクエリをどんなリレーに送信してもよい(MAY)。

リレーごとに実装詳細には差異がありうるので、それを埋めるため、
クライアントは、このNIPをサポートしている複数のリレーをクエリするべきだ(SHOULD)。

クライアントは、リレーの返したイベントが、クライアントのユースケースにしたがって指定されたクエリにマッチするかどうかを検証してよい(MAY)。
また、精度が低いリレーに対してクエリするのを停止してもよい(MAY)。

リレーは、もし何らかのスパムフィルタをサポートしているのであれば、デフォルトでスパムを検索結果から除外すべきだ(SHOULD)。

## 拡張

<<<<<<< HEAD
リレーは以下のような拡張をサポートしてもよい(MAY):
- `include:spam` - スパムフィルタをオフにする(デフォルトで有効な場合)
=======
Relay MAY support these extensions:
- `include:spam` - turn off spam filtering, if it was enabled by default
- `domain:<domain>` - include only events from users whose valid nip05 domain matches the domain
- `language:<two letter ISO 639-1 language code>` - include only events of a specified language
- `sentiment:<negative/neutral/positive>` - include only events of a specific sentiment
- `nsfw:<true/false>` - include or exclude nsfw events (default: true)
>>>>>>> upstream/master
